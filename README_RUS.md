**Цель**

CelestialSurveyor предназначен для анализа астрономических изображений и поиска движущихся объектов (таких как астероиды и кометы).

Мой личный сценарий использования, который я постарался реализовать и сделать максимально простым:

- Астроном провел сеанс съемки со своим телескопом.

- Астроном загружает Light и калибровочные кадры без какой-либо предварительной обработки в CelestialSurveyor.

- Астроном нажимает одну кнопку и получает области интереса, где высокая вероятность обнаружения астероида или кометы, а также список известных объектов в данном поле зрения, отмеченных на изображении.

- Если есть объекты, не отмеченные как известные, астроном предпринимает действия, чтобы подтвердить или опровергнуть свое открытие.

Я полагаю, что многие люди, интересующиеся астрофотографией, не ищут что-то новое на своих изображениях. Именно поэтому я работал над этим инструментом, чтобы сделать этот процесс простым, как раз-два-три.

**Пример использования**

- Запустите приложение.

- Укажите пути к калибровочным кадрам, если таковые имеются. Настоятельно рекомендуется иметь актуальные кадры темнового поля (Dark), чтобы избежать влияния горячих пикселей.
 
<img width="1277" alt="calibration" src="https://github.com/user-attachments/assets/6aa499b9-aaef-4730-8c67-578392add6ef">

- Добавьте световые кадры, нажав кнопку "Add files". Убедитесь, что все Light кадры имеют одинаковую выдержку (эта информация будет показана в списке файлов). Если это не так, снимите галочки с кадров с неправильной выдержкой.
 
<img width="1276" alt="add_files" src="https://github.com/user-attachments/assets/42df7013-7cf7-4b7d-b9ce-4bf1c6481be6">

- Отметьте галку "Debayer", если вы используете цветную камеру. Для монохромных камер этот флажок ДОЛЖЕН быть снят.

- Отметьте "Align images", если изображения предварительно не выровнены (по сути, если предоставлены необработанные файлы без предварительной обработки - этот флажок необходимо установить).

- Флажок "Non-linear" должен быть установлен, если ваши изображения по какой-то причине оказались "стретчнуты". В противном случае, если изображения без предварительной обработки - этот флажок должен быть снят.

На предыдущем изображении показан наиболее распространенный случай использования этих флажков.

Если все в порядке, нажмите "Загрузить изображения". Начнется загрузка. Шаги, которые будут выполнены на этом этапе (ПРИМЕЧАНИЕ: оригинальные файлы не будут изменены):

1) загрузка изображений
2) калибровка изображений
3) астрометрическая привязка каждого кадра
4) выравнивание изображений на основе решения астрометрической привязки
5) обрезка (чтобы избежать черных областей после выравнивания)
6) Stretch.

<img width="1277" alt="running_process" src="https://github.com/user-attachments/assets/bb2f2e45-ed11-4b00-bb70-e6a08b1a0e68">

- Просмотрите световые кадры, переходя по списку файлов. Изображения будут показаны справа. Снимите галочки с плохих кадров.

- Выберите папку, где будут сохранены результаты.

- Выберите "Annotation magnitude limit". Это значение используется в запросе на получение известных объектов. Слишком большие значения приведут к долгому времени запроса и слишком большому количеству объектов, отмеченных на итоговом изображении. Выберите значение, подходящее для вашего оборудования.

- Нажмите "Process".

- После завершения обработки откройте папку, которую вы указали для сохранения результатов.

В папке есть файлы под названием "results.png" и "results_annotated.png". На них показаны области интереса, найденные нейросетью с указанием вероятностей. Для отображения результатов используется максимальное изображение (это означает, что каждый пиксель имеет максимальное значение из всей серии изображений), поэтому на нем могут быть видны некоторые яркие астероиды. Несколько близких результатов с вероятностью 1.00 означают, что, скорее всего, между звездами что-то движется. Красные прямоугольники с красными номерами обозначают области, для которых созданы и сохранены .gif изображения в папке с результатами. Примечание: нейросеть была обучена не обращать внимания на артефакты, появляющиеся на отдельных изображениях, такие как следы метеоров и самолетов, космические лучи и горячие пиксели. Однако, если есть горячие пиксели, которые не были удалены калибровкой с темновыми кадрами и dithering был недостаточно случайный, они могут быть помечены нейросетью как области интереса. Все результаты должны быть проверены визуально.

![results](https://github.com/user-attachments/assets/bd9f9559-8214-4893-97f0-5497136d0054)

Второй файл содержит аннотации для известных объектов. Аннотации выполнены для первого изображения каждого сеанса съемки. Так что, если вы предоставили данные за две ночи подряд, возможно, астероид будет отмечен дважды, в зависимости от условий съемки.

![results_annotated](https://github.com/user-attachments/assets/00bf577b-c4e1-433c-a073-245e41b2121a)

Примеры .gif файлов с найденным известным астероидом 934 Тюрингия (A920 PA). gifs номер 6 и 7:

![6](https://github.com/user-attachments/assets/5656c148-792f-4d25-a365-4f33f198a748)
![7](https://github.com/user-attachments/assets/667425c4-c144-4748-872c-cad0f538af1b)

**Билды:**

Windows: https://disk.yandex.ru/d/bkHGEy0MK0LOVw

Ubuntu: https://disk.yandex.ru/d/_9tUR1nmmqZctg

**Установка**

- Скачать.
- Распаковать.
- Должно работать из коробки.

**Клонирование репозитория**

git lfs необходим для клонирования крупных файлов ИИ модели. 